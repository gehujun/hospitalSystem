<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--namespace:命名空间  -->
<mapper namespace="com.web.dao.SupplierDao">

   <!-- 自定义结果集 -->
   <resultMap type="Supplier" id="resultSupplier">
   
     <!-- 主键   column:表中的字段名称      property:类中的属性名称 -->
      <id column="supid" property="supid"/>
      
      <result column="supname" property="supname"/>
      <result column="supaddr" property="supaddr"/>
      <result column="suptel" property="suptel"/>
      <result column="supcreditconditions" property="supcreditconditions"/>
      <result column="isdelete" property="isdelete"/>
      
       <!-- 多对一   property:属性名称   javaType：关联的对象类型-->
<!--      <association property="user" javaType="TUser"> -->
<!--          <id column="userId" property="userId"/> -->
         
<!--          <result column="userName" property="userName"/> -->
<!--          <result column="userSex" property="userSex"/> -->
<!--          <result column="userBirthday" property="userBirthday"/> -->
<!--          <result column="userCard" property="userCard"/> -->
<!--      </association> -->
  
     <!-- 一对多   ofType:关联的对象
     <collection property="positionList" ofType="TPosition">
           <id column="poId" property="poId"/>
           
           <result column="poName" property="poName"/>
           <result column="deptId" property="deptId"/>
           <result column="poSalary" property="poSalary"/>
           <result column="isDelete" property="isDelete"/>
     </collection> -->
     
   </resultMap>
 
     <!-- 查询 
             SELECT d.*,p.*
		    from t_position p,t_department d
		       where p.deptId=d.deptId
     -->
     <select id="query" resultMap="resultSupplier">
          SELECT s.*
		    from Supplier s
     </select>
    
     
     <!-- 自定义SQL语句，以便于其他地方重复使用 -->
     <sql id="supplierCondition">
                  where s.isdelete!=0
		         <if test="supname!=null and  supname!=''">
				       and supname like concat('%',concat(#{supname},'%'))
				  </if>
				  <if test="suptel !=null and suptel!=''">
				      and suptel like concat('%',concat(#{suptel},'%'))
				  </if>
				  <if test="supaddr !=null and supaddr!=''">
				      and supaddr like concat('%',concat(#{supaddr},'%'))
				  </if>
				  
     </sql>

   <!--resultMap:结果集      parameterType:参数类型
    SELECT d.*,p.*
		    from t_position p,t_department d
		       where p.deptId=d.deptId
		  <if test="deptName!=null and  deptName!=''">
		       and d.deptName like concat('%',concat(#{deptName},'%'))
		  </if>
		  <if test="deptPhone !=null and deptPhone!=''">
		      and d.deptPhone like concat('%',concat(#{deptPhone},'%'))
		  </if>
		  
		  include:包含     refid:引用的id名称-->
    <select id="queryByCondition" resultMap="resultSupplier" parameterType="Supplier">
           SELECT s.*
		    from Supplier s
		   <include refid="supplierCondition"/>
    </select>
    
    <!-- 
     SELECT d.*,p.*
		    from t_position p,t_department d
         where p.deptid=d.deptid
           and d.deptid in (1,2,3)
           collection:集合    open：开始标签    close:结束标签      item:集合中的每个对象（变量）
           separator:分隔符
     -->
<!--     <select id="queryByIds" parameterType="Integer" resultMap="resultDeparment" > -->
<!--             SELECT d.*,p.* -->
<!-- 		    from t_position p,t_department d -->
<!-- 		    <where> -->
<!-- 		         p.deptid=d.deptid -->
<!-- 		         <if test="ids != null and ids.size>0"> -->
<!-- 			         <foreach collection="ids" open="and d.deptid in (" close=")" item="deptId" separator="," > -->
<!-- 			               #{deptId} -->
<!-- 			         </foreach> -->
<!-- 		         </if> -->
<!-- 		    </where> -->
<!--     </select> -->
    
    <!-- 根据id查询对象 -->
    <select id="findById" parameterType="Integer" resultType="Supplier">
       select * from Supplier where supid=#{supid}
    </select>
    
    <!-- 修改 -->
    <update id="update" parameterType="Supplier">
         update Supplier set
          <if test="supname!=null and  supname!=''">
             supname=#{supname},
          </if>
           <if test="supaddr!=null and  supaddr!=''">
		      supaddr=#{supaddr},
		  </if>
		   <if test="suptel!=null and  suptel!=''">
		      suptel=#{suptel}
		  </if>
		  where supid=#{supid}
    </update>
    
    <!-- 删除 -->
    <delete id="delete" parameterType = "Integer">
    		<!-- delete from t_position where deptId=#{deptId}; -->
    		<!-- delete from t_department where deptId=#{deptId} -->
    		update Supplier set isdelete= 0 where supid=#{supid}
    </delete>
    
   	<insert id="add" parameterType="Supplier">
	insert into Supplier (supname,supaddr,suptel,supcreditconditions,isdelete) 
	values (#{supname},#{supaddr},#{suptel},#{supcreditconditions},1)
	<!-- 自动增长后的主键   -->
        <selectKey keyColumn="supid" keyProperty="supid" resultType="int">
        	SELECT LAST_INSERT_id()
        </selectKey>
	</insert>
    
    
    
</mapper>

