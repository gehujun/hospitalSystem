<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--namespace:命名空间  -->
<mapper namespace="com.web.dao.TravelactivitiesDao">

   <!-- 自定义结果集 -->
   <resultMap type="Travelactivities" id="resultTravelactivities">
   
     <!-- 主键   column:表中的字段名称      property:类中的属性名称 -->
      <id column="traid" property="traid"/>
      
      <result column="traname" property="traname"/>
      <result column="tradest" property="tradest"/>
      <result column="trastart" property="trastart"/>
      <result column="tracontent" property="tracontent"/>
      <result column="trafee" property="trafee"/>
      <result column="tradate" property="tradate"/>
      <result column="isdelete" property="isdelete"/>
      
<!--        多对一   property:属性名称   javaType：关联的对象类型 -->
<!--      <association property="user" javaType="TUser"> -->
<!--          <id column="trafee" property="trafee"/> -->
         
<!--          <result column="userName" property="userName"/> -->
<!--          <result column="userSex" property="userSex"/> -->
<!--          <result column="userBirthday" property="userBirthday"/> -->
<!--          <result column="userCard" property="userCard"/> -->
<!--      </association> -->
  
     <!-- 一对多   ofType:关联的对象
     <collection property="positionList" ofType="TPosition">
           <id column="poId" property="poId"/>
           
           <result column="poName" property="poName"/>
           <result column="traid" property="traid"/>
           <result column="poSalary" property="poSalary"/>
           <result column="isDelete" property="isDelete"/>
     </collection> -->
     
   </resultMap>
 
     <!-- 查询 
             SELECT d.*,p.*
		    from t_position p,t_department d
		       where p.traid=d.traid
     -->
     <select id="query" resultMap="resultTravelactivities">
          select t.*
          	from Travelactivities t
     </select>
    
     
     <!-- 自定义SQL语句，以便于其他地方重复使用 -->
     <sql id="travelactivitiesCondition">
           		  where t.isdelete=1
		         <if test="tradest!=null and  tradest!=''">
				       and t.tradest like concat('%',concat(#{tradest},'%'))
				  </if>
				  <if test="tracontent !=null and tracontent!=''">
				      and t.tracontent like concat('%',concat(#{tracontent},'%'))
				  </if>
				  <if test="trastart !=null and trastart!=''">
				      and t.trastart like concat('%',concat(#{trastart},'%'))
				  </if>				  
     </sql>

   <!--resultMap:结果集      parameterType:参数类型
    SELECT d.*,p.*
		    from t_position p,t_department d
		       where p.traid=d.traid
		  <if test="tradest!=null and  tradest!=''">
		       and d.tradest like concat('%',concat(#{tradest},'%'))
		  </if>
		  <if test="tracontent !=null and tracontent!=''">
		      and d.tracontent like concat('%',concat(#{tracontent},'%'))
		  </if>
		  
		  include:包含     refid:引用的id名称-->
    <select id="queryByCondition" resultMap="resultTravelactivities" parameterType="Travelactivities">
		    select t.*
          	from Travelactivities t
		   <include refid="travelactivitiesCondition"/>
    </select>
    
    <!-- 
     SELECT d.*,p.*
		    from t_position p,t_department d
         where p.traid=d.traid
           and d.traid in (1,2,3)
           collection:集合    open：开始标签    close:结束标签      item:集合中的每个对象（变量）
           separator:分隔符
     -->
<!--     <select id="queryByIds" parameterType="Integer" resultMap="resultTravelactivities" > -->
<!--             SELECT d.*,p.* -->
<!-- 		    from t_position p,t_department d -->
<!-- 		    <where> -->
<!-- 		         p.traid=d.traid -->
<!-- 		         <if test="ids != null and ids.size>0"> -->
<!-- 			         <foreach collection="ids" open="and d.traid in (" close=")" item="traid" separator="," > -->
<!-- 			               #{traid} -->
<!-- 			         </foreach> -->
<!-- 		         </if> -->
<!-- 		    </where> -->
<!--     </select> -->
    
    <!-- 根据id查询对象 -->
    <select id="findById" parameterType="Integer" resultType="Travelactivities">
       select * from Travelactivities where traid=#{traid}
    </select>
    
    <!-- 修改 -->
    <update id="update" parameterType="Travelactivities">
         update Travelactivities set
         <if test="traname!=null and  traname!=''">
             traname=#{traname},
          </if>
          <if test="tradest!=null and  tradest!=''">
             tradest=#{tradest},
          </if>
           <if test="trastart!=null and  trastart!=''">
		      trastart=#{trastart},
		  </if>
		   <if test="tracontent!=null and  tracontent!=''">
		      tracontent=#{tracontent},
		  </if>
		  <if test="tracontent!=null and  tracontent!=''">
		      trafee=#{trafee},
		  </if>
		  <if test="tracontent!=null and  tracontent!=''">
		      tradate=#{tradate}
		  </if>
		  where traid=#{traid}
    </update>
    
    <!-- 删除 -->
    <delete id="delete" parameterType = "Integer">
    		<!-- delete from t_position where traid=#{traid}; -->
    		<!-- delete from t_department where traid=#{traid} -->
    		update Travelactivities set isdelete = 0 where traid=#{traid}
    </delete>
    
    <insert id="add" parameterType="Travelactivities">     
	   insert into Travelactivities (traname,tradest, trastart, tracontent,trafee,tradate,isdelete)
	   values (#{traname},#{tradest}, #{trastart},#{tracontent},#{trafee},#{tradate},1)
	   <!-- 自动增长后的主键   -->
	   <selectKey keyColumn="traid" keyProperty="traid" resultType="int">
	   	SELECT LAST_INSERT_id()
	   </selectKey>
    </insert>
    
    
    
    
</mapper>

